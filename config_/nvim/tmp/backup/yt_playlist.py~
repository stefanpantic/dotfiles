import sys
import re
import urllib.request as req
from bs4 import BeautifulSoup as Supa

if 2 != len(sys.argv):
    exit(1)

name = 0
url = sys.argv[1].strip()
yt_url = "https://www.youtube.com"
yt_dl = "http://www.yt2mp3.cc/"
yt_dl_grab = "http://www.yt2mp3.cc/grab?vidID="
yt_dl_format = "&format=mp3"

page = req.urlopen(url)
page_text = page.read()
page.close()
yt_soup = Supa(page_text, "html5lib")
yt_href_pat = re.compile('href="(?:.*?)=([^&]+)')

yt2mp3_href_pat = re.compile('href="([^"]+)')

for link in yt_soup.find_all('a', class_='pl-video-title-link yt-uix-tile-link yt-uix-sessionlink spf-link '):
    href_mtc = yt_href_pat.search(str(link));
    if None != href_mtc:
        print(href_mtc.group(1))
        yt2mp3_soup = Supa(req.urlopen(yt_dl_grab + href_mtc.group(1) + yt_dl_format).read(), "html5lib")
        dl_url = yt2mp3_soup.find('a', class_='download-mp3-url btn audio q320')
        dl_mat = yt2mp3_href_pat.search(str(dl_url))
        print(str(dl_url))
        if None != dl_mat:
            print(dl_mat.group(1))
            #song = req.urlopen(yt_dl + dl_mat.group(1)).read()
            #o_file = open(str(name) + ".mp3", "wb+")
            #o_file.write(song)
            #o_file.close()
            #name += 1





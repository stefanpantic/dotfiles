#!/bin/sh
function get_user()
{
	ls /home |
			grep  -E '(a[if][0-9]+)|(m[ilnvr][0-9]+)' |
			sed 's/\///'
}

function get_detial()
{
	echo "$1" |
	xargs -n 1 finger 2>/dev/null|
	grep -E 'Login' |
	sed -r 's/Login: (a[if]|m[ailnvrm])([0-9]{2})([0-9]{3,})\s*Name: (.*)/\4|:|\3\/20\2|:|\1/'
}


function write_user()
{
	IFS=$'|:|';tmp=($2);unset IFS

	echo "${tmp[0]}" | grep -E '^[A-Za-z .-]+$' > /dev/null
	if [[ "$?" -eq 1 ]]; then
		echo -e "\t\t\t<tr class=\"bg-danger\">"
	else
		echo -e "\t\t\t<tr>"
	fi

cat << EOF
				<td>$1</td>
				<td>${tmp[0]}</td>
				<td>${tmp[3]}</td>
EOF
	case ${tmp[6]} in
			ai)
				echo -e "\t\t\t\t<td>Astroinformatika</td>"
			;;
			af)
				echo -e "\t\t\t\t<td>Astrofizika</td>"
			;;
			ma)
				echo -e "\t\t\t\t<td>Astronomija</td>"
			;;
			mi)
				echo -e "\t\t\t\t<td>Informatika</td>"
			;;
			ml)
				echo -e "\t\t\t\t<td>Profesorski smer</td>"
			;;
			mn)
				echo -e "\t\t\t\t<td>Primenjanea</td>"
			;;
			mv)
				echo -e "\t\t\t\t<td>Statistika</td>"
			;;
			mr)
				echo -e "\t\t\t\t<td>Racunarstvo i informatika</td>"
			;;
			mm)
				echo -e "\t\t\t\t<td>Teoriska matematika</td>"
			;;
	esac

	echo -e "\t\t\t</tr>"
}

users=$(get_user)
processed=$(get_detial "$users")
IFS=$'\n';processed=($processed);unset IFS


IFS=$'\n';processed=($(sort <<< "${processed[*]}"));unset IFS

cat << EOF
<html>
	<head>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
	</head>
	<body>
		<table class="table table-inverse table-striped table-responsive">
			<th>#</th>
			<th>Puno ime</th>
			<th>Indeks</th>
			<th>Smer</th>
EOF

for (( i = 0; i < ${#processed[@]}; i++ )); do
	write_user "$(expr $i + 1)" "${processed[$i]}"
done

cat << EOF
		</table>
		<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
	</body>
</html>
EOF
